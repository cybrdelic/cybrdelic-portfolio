<!-- templates/sections/projects.html -->
<section id="PROJECTS">
    <div class="container">

        <div class="projects-container">
            <!-- Project Details Panel (Left Side - Sticky) -->
            <div class="project-details-panel">
                <!-- Default state when no project is selected -->
                <div class="default-project-view">
                    <h3 class="details-header">Select a project</h3>
                    <p class="details-description">
                        I build tools that enhance developer productivity and create elegant solutions to complex
                        problems.
                        My work spans CLI utilities to AI-powered tools, focusing on performance and usability.
                    </p>

                    <div class="details-stats">
                        <div class="stat-box">
                            <div class="stat-number">10+</div>
                            <div class="stat-label">Projects</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number">4</div>
                            <div class="stat-label">Core Tech</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number">7+</div>
                            <div class="stat-label">Years Exp</div>
                        </div>
                    </div>

                    <div class="expertise-section">
                        <h3 class="details-subheader">Areas of Focus</h3>
                        <div class="expertise-tags">
                            <span class="expertise-tag">Developer Tools</span>
                            <span class="expertise-tag">AI Integration</span>
                            <span class="expertise-tag">CLI Apps</span>
                            <span class="expertise-tag">Data Viz</span>
                            <span class="expertise-tag">Automation</span>
                            <span class="expertise-tag">Web Apps</span>
                        </div>
                    </div>
                </div>

                <!-- Project-specific details that show when a project is selected -->
                <div class="selected-project-view">
                    <h3 class="details-header"><span class="selected-project-title">Project Name</span></h3>
                    <div class="details-subtitle"><span class="selected-project-subtitle">Project Type</span></div>

                    <p class="details-description selected-project-description">
                        Select a project to view details.
                    </p>

                    <div class="details-meta">
                        <div class="stat-box">
                            <div class="stat-label">Status</div>
                            <div class="selected-project-status">-</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Year</div>
                            <div class="selected-project-year">-</div>
                        </div>
                    </div>

                    <div class="tech-section">
                        <h3 class="details-subheader">Technologies</h3>
                        <div class="selected-project-tech-tags"></div>
                    </div>

                    <a href="#" class="details-link">
                        <span class="details-link-text">View Full Details</span>
                        <span class="details-link-icon">â†’</span>
                    </a>
                </div>
            </div>

            <!-- Projects List (Right Side) -->
            <div class="projects-list">
                {% for project in projects %}
                <div class="project-list-item" data-id="{{ project.id }}" data-subtitle="{{ project.subtitle }}"
                    data-year="{{ project.year | default(value='2023') }}"
                    data-status="{{ project.status | default(value='Active') }}" tabindex="0"
                    aria-label="Project: {{ project.title }}">
                    <h3 class="project-list-title">{{ project.title }}</h3>

                    <!-- Hidden data for JavaScript to use -->
                    <div class="hidden-project-data">
                        <div class="hidden-description">{{ project.description }}</div>
                        <div class="hidden-tech-stack">
                            {% for tech in project.tech_stack %}
                            <span class="tech-item">{{ tech }}</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const projectsSection = document.getElementById('PROJECTS');
            const projectItems = document.querySelectorAll('.project-list-item');
            const defaultView = document.querySelector('.default-project-view');
            const selectedView = document.querySelector('.selected-project-view');
            const detailsLink = document.querySelector('.details-link');
            const detailsPanel = document.querySelector('.project-details-panel');

            const isTouchDevice = ('ontouchstart' in window) ||
                (navigator.maxTouchPoints > 0) ||
                (navigator.msMaxTouchPoints > 0);

            // Initially hide the selected project view
            selectedView.style.display = 'none';
            defaultView.style.display = 'block';

            // Add tabindex to details panel for better accessibility
            detailsPanel.setAttribute('tabindex', '-1');

            // Setup animation for list items
            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        const item = entry.target;
                        const index = Array.from(projectItems).indexOf(item);
                        setTimeout(() => {
                            item.classList.add('reveal');
                        }, 80 * index);

                        observer.unobserve(item);
                    }
                });
            }, { threshold: 0.1 });

            // Observe each project item
            projectItems.forEach((item) => {
                observer.observe(item);
            });

            // Function to update project details
            function updateProjectDetails(item) {
                // Get data from the selected project
                const title = item.querySelector('.project-list-title').textContent;
                const subtitle = item.getAttribute('data-subtitle');
                const year = item.getAttribute('data-year');
                const status = item.getAttribute('data-status');
                const description = item.querySelector('.hidden-description').textContent;
                const techItems = item.querySelectorAll('.tech-item');
                const projectId = item.getAttribute('data-id');

                // Update the details panel
                document.querySelector('.selected-project-title').textContent = title;
                document.querySelector('.selected-project-subtitle').textContent = subtitle;
                document.querySelector('.selected-project-description').textContent = description;
                document.querySelector('.selected-project-status').textContent = status;
                document.querySelector('.selected-project-year').textContent = year;

                // Update tech tags
                const techTagsContainer = document.querySelector('.selected-project-tech-tags');
                techTagsContainer.innerHTML = '';
                techItems.forEach(item => {
                    const techTag = document.createElement('span');
                    techTag.className = 'tech-tag';
                    techTag.textContent = item.textContent;
                    techTagsContainer.appendChild(techTag);
                });

                // Update the "View Full Details" link
                detailsLink.href = `/projects/${projectId}`;

                // Show the selected view, hide the default view
                defaultView.style.display = 'none';
                selectedView.style.display = 'block';
            }

            // Handle project item interactions
            projectItems.forEach(item => {
                // Click/tap handler
                item.addEventListener('click', () => {
                    // Remove active class from all items
                    projectItems.forEach(p => p.classList.remove('active'));

                    // Add active class to clicked item
                    item.classList.add('active');

                    // Update the details panel
                    updateProjectDetails(item);
                });

                // Hover effect for non-touch devices
                if (!isTouchDevice) {
                    item.addEventListener('mouseenter', () => {
                        projectItems.forEach(p => {
                            if (p !== item) p.classList.add('dim');
                        });
                    });

                    item.addEventListener('mouseleave', () => {
                        projectItems.forEach(p => p.classList.remove('dim'));
                    });
                }

                // Keyboard accessibility
                item.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();

                        // Simulate click
                        item.click();

                        // Focus on the details panel for better accessibility
                        document.querySelector('.project-details-panel').focus();
                    }
                });
            });

            // Set first project as active by default with a smooth animation
            if (projectItems.length > 0) {
                // Add a small delay to ensure everything is loaded first
                setTimeout(() => {
                    const firstProject = projectItems[0];
                    firstProject.classList.add('active');
                    // Add a subtle animation to draw attention to the first selection
                    firstProject.style.transition = 'all 0.8s cubic-bezier(0.165, 0.84, 0.44, 1)';
                    firstProject.style.background = 'rgba(255, 255, 255, 0.05)';

                    updateProjectDetails(firstProject);

                    // Reset the background after animation
                    setTimeout(() => {
                        firstProject.style.transition = '';
                        firstProject.style.background = '';
                    }, 1200);
                }, 300);
            }

            // Handle focus management for accessibility
            projectsSection.addEventListener('focusin', (e) => {
                if (e.target.classList.contains('project-list-item')) {
                    projectItems.forEach(p => {
                        if (p !== e.target) p.classList.remove('active');
                    });
                    e.target.classList.add('active');
                    updateProjectDetails(e.target);
                }
            });
        });
    </script>
</section>
