<!-- templates/sections/projects.html -->
<section id="PROJECTS">
    <div class="container">
        
        <div class="projects-layout">
            <!-- Projects list -->
            <div class="projects-list">
                {% for project in projects %}
                <div class="project-card" data-id="{{ project.id }}" data-project="{{ project.id }}" tabindex="0">
                    <div class="project-content">
                        <h3 class="project-title">{{ project.title }}</h3>
                        <div class="project-type">{{ project.subtitle }}</div>
                        <div class="project-more">
                            <span class="more-icon">→</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Project visualization -->
            <div class="project-visualization">
                <div class="project-panel-header">
                    <div class="project-panel-controls">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <div class="project-panel-title">
                        <span class="terminal-prefix">~/projects</span>
                        <span class="terminal-cursor">▋</span>
                    </div>
                </div>
                <div class="project-icon-container" id="project-icon-container">
                    <!-- Fixed static illustration as default -->
                    <div class="icon-wrapper active" data-icon="default">
                        <div class="project-default-icon">
                            <div class="code-snippet">
                                <div class="code-line"></div>
                                <div class="code-line"></div>
                                <div class="code-line"></div>
                                <div class="code-line"></div>
                                <div class="code-line"></div>
                                <div class="code-line"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Project-specific icons -->
                    <div class="icon-wrapper" data-icon="jjugg">
                        <div class="icon-scaling-wrapper">
                            {% include "components/animated_icons/jjugg.html" %}
                        </div>
                        <div class="project-tech-tags">
                            <span class="tech-tag">JavaScript</span>
                            <span class="tech-tag">HTML</span>
                            <span class="tech-tag">LocalStorage</span>
                        </div>
                    </div>
                    <div class="icon-wrapper" data-icon="sagacity">
                        <div class="icon-scaling-wrapper">
                            {% include "components/animated_icons/sagacity.html" %}
                        </div>
                        <div class="project-tech-tags">
                            <span class="tech-tag">Rust</span>
                            <span class="tech-tag">NLP</span>
                            <span class="tech-tag">AI</span>
                        </div>
                    </div>
                    <div class="icon-wrapper" data-icon="commitaura">
                        <div class="icon-scaling-wrapper">
                            {% include "components/animated_icons/commitaura.html" %}
                        </div>
                        <div class="project-tech-tags">
                            <span class="tech-tag">Rust</span>
                            <span class="tech-tag">Git</span>
                            <span class="tech-tag">AI</span>
                        </div>
                    </div>
                    <div class="icon-wrapper" data-icon="resumatyk">
                        <div class="icon-scaling-wrapper">
                            {% include "components/animated_icons/resumatyk.html" %}
                        </div>
                        <div class="project-tech-tags">
                            <span class="tech-tag">Python</span>
                            <span class="tech-tag">LaTeX</span>
                            <span class="tech-tag">AI</span>
                        </div>
                    </div>
                    <div class="icon-wrapper" data-icon="cybrdelic_portfolio">
                        <div class="icon-scaling-wrapper">
                            {% include "components/animated_icons/cybrdelic_portfolio.html" %}
                        </div>
                        <div class="project-tech-tags">
                            <span class="tech-tag">Rust</span>
                            <span class="tech-tag">HTML</span>
                            <span class="tech-tag">CSS</span>
                        </div>
                    </div>
                    <div class="icon-wrapper" data-icon="lester">
                        <div class="icon-scaling-wrapper">
                            {% include "components/animated_icons/lester.html" %}
                        </div>
                        <div class="project-tech-tags">
                            <span class="tech-tag">Rust</span>
                            <span class="tech-tag">P2P</span>
                            <span class="tech-tag">Cryptography</span>
                        </div>
                    </div>
                    <div class="icon-wrapper" data-icon="browsealizer">
                        <div class="icon-scaling-wrapper">
                            {% include "components/animated_icons/browsealizer.html" %}
                        </div>
                        <div class="project-tech-tags">
                            <span class="tech-tag">React</span>
                            <span class="tech-tag">GitHub API</span>
                            <span class="tech-tag">TypeScript</span>
                        </div>
                    </div>
                </div>
                <div class="project-status-bar">
                    <div class="status-indicator">
                        <span class="status-dot"></span>
                        <span class="status-text">Ready</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const projectCards = document.querySelectorAll('#PROJECTS .project-card');
            const iconWrappers = document.querySelectorAll('#project-icon-container .icon-wrapper');
            let currentProject = null;
            let iconChangeTimeout = null;
            
            // Card reveal animation
            projectCards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('reveal');
                }, 120 * index);
            });

            // Function to show the corresponding project icon
            function showProjectIcon(projectId) {
                // Clear any pending timeout
                if (iconChangeTimeout) {
                    clearTimeout(iconChangeTimeout);
                }
                
                // Save current project
                currentProject = projectId;
                
                // Hide all icons first
                iconWrappers.forEach(wrapper => {
                    wrapper.classList.remove('active');
                });
                
                // Try to find a matching icon for the project
                const matchingIcon = document.querySelector(`.icon-wrapper[data-icon="${projectId}"]`);
                
                if (matchingIcon) {
                    matchingIcon.classList.add('active');
                } else {
                    // Fall back to default if no matching icon
                    document.querySelector('.icon-wrapper[data-icon="default"]').classList.add('active');
                }
            }

            // Reset to default icon
            function resetToDefaultIcon() {
                // Set a delay to avoid flickering when moving between cards
                iconChangeTimeout = setTimeout(() => {
                    // Only reset if no active project
                    if (!currentProject) {
                        iconWrappers.forEach(wrapper => {
                            wrapper.classList.remove('active');
                        });
                        document.querySelector('.icon-wrapper[data-icon="default"]').classList.add('active');
                    }
                }, 100);
            }

            // Card hover handler for icon change
            projectCards.forEach(card => {
                card.addEventListener('mouseenter', () => {
                    const projectId = card.getAttribute('data-project');
                    showProjectIcon(projectId);
                    
                    // Highlight the active card
                    projectCards.forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                });

                card.addEventListener('mouseleave', () => {
                    // Set current project to null
                    currentProject = null;
                    card.classList.remove('active');
                    resetToDefaultIcon();
                });

                // Card click handler
                card.addEventListener('click', () => {
                    const projectId = card.getAttribute('data-id');
                    window.location.href = `/projects/${projectId}`;
                });

                // Keyboard accessibility
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const projectId = card.getAttribute('data-id');
                        window.location.href = `/projects/${projectId}`;
                    }
                });
            });

            // Animation for default code snippet
            function animateCodeSnippet() {
                const codeLines = document.querySelectorAll('.code-snippet .code-line');
                codeLines.forEach((line, index) => {
                    // Random width for each line
                    const width = 50 + Math.random() * 40;
                    line.style.width = `${width}%`;
                    
                    // Staggered animation
                    setTimeout(() => {
                        line.classList.add('animate');
                        
                        // Reset animation periodically
                        setTimeout(() => {
                            line.classList.remove('animate');
                            setTimeout(() => {
                                animateCodeSnippet();
                            }, 100);
                        }, 3000);
                    }, index * 200);
                });
            }
            
            // Start code snippet animation
            animateCodeSnippet();
        });
    </script>
</section>
